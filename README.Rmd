---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

**NOTE: This is a toy package created for expository purposes. It is not intended to be used for any other purpose.**

### Hacking intervals

There are two types of hacking intervals:

* **Prescriptively constrained** hacking intervals give the range of results that could be achieved subject to user specified constraints.
* **Tethered** hacking intervals compute range of results that could be achieved subject to *any* manipulation so long as the loss changes by only a small amount. 

This package computes tethered and prescriptively constrained hacking intervals, as well as an interval that considers both types of hacking, for linear models. 

For the prescriptively constrained hacking intervals, up to one of the following modifications is considered at once:

* Removing any additive term in the base model.
* Applying a transformation (currently `x^2` only) to any linear term included in the base model. 
* Adding a linear term for any variable in the dataset. 
* Removing a single observation.

### Installation

```{r installation, eval = FALSE}
devtools::install_github("beauCoker/hacking")
```
  
### Quick demo

Start with a datset. For this demo we'll generate a toy dataset `data`. 

```{r}
set.seed(0)

N = 50 # Number of observations
data <- data.frame(
  y = rnorm(N), # Response variable (continuous)
  w = rbinom(N, 1, .5), # Treatment variable (binary)
  X = matrix(rnorm(N*3), nrow=N), # Covariates included in base model
  Z = matrix(rnorm(N*3), nrow=N) # Covariates excluded from base model
)
```

Next, fit a linear model with `lm`. We'll call this the "base" model. 

```{r}
mdl <- lm(y ~ w + X.1*X.2, data=data)
(beta_0 <- mdl$coefficients['w'])
```

So, the ordinary least squares estimate for the coefficent `beta_0` on the treatment variable `w` is about `r round(beta_0,2)`. A standard question in statistics is to ask, "what could happen if I estimated `beta_0` using a different datset drawn from the same distribution?" This is what a standard confidence interval tells you. It can be computed with `R`'s built-in `confint` function:
```{r}
(ci <- confint(mdl)['w',])
```

Now we get to the hacking interval part. What if instead you ask, "what if the scientist that reported this estimate threw out some important observations, or messed with the data in some other way? What's the range of estimates that could have been reported?" This is what a hacking interval tells you. For linera models, it can be computed with the `hackint_lm` function in this package:

```{r}
library(hacking)
output <- hackint_lm(mdl, data, theta=0.1)
```

The parameter `theta` tells you what percentage of loss is tolerated for tetehred hacking. `LB` and `UB` stand for lower bound and upper bound. 
This means that a tethered hacking interval around the base model is (`r round(output$tethered,2)`), a prescriptively constrained hacking interval around the base model is (`r round(output$constrained,2)`), and a hacking interval that considers both types is (`r round(output$tethered_and_constrained,2)`). Notice either of the tethered intervals are wider than the standard confidence interval. 

`hackint_lm` also returns the full list of all the manipulations that were tried, the minimum-loss estimate `Estimate` for each manipulation, and the tethered hacking interval `(LB,UB)` around each. The output is sorted by the largest absolute difference `largest_diff` of any value (`LB`, `Estiamte`, or `UB`) from `beta_0`:

```{r}
head(output$hacks_all)
```

